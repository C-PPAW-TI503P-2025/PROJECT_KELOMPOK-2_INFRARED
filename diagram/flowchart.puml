@startuml
title Flowchart Sistem (End-to-End)

start
:Nyalakan Perangkat (ESP32);
:Koneksi ke Wi-Fi;

partition "Looping Perangkat Keras" {
  repeat
    :Baca Status Sensor IR;
    if (Objek Terdeteksi?) then (YA)
      :Buka Servo (90 Derajat);
      
      :Siapkan Data JSON
      (sensor_id, count, notes);
      
      :Kirim HTTP POST ke Server;
      
      if (Sukses Terkirim?) then (YA)
        :Log Serial: Sukses;
      else (TIDAK)
        :Log Serial: Gagal;
      endif
      
      :Delay 3 Detik;
      :Tutup Servo (0 Derajat);
    else (TIDAK)
      :Standby (Tunggu Gerakan);
    endif
  repeat while (Alat Hidup)
}

partition "Logika Server" {
  :Terima Data API;
  :Simpan ke Tabel 'trash_entries';
  :Update Dashboard;
}

stop
@enduml